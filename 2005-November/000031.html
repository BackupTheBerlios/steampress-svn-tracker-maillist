<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [steampress-svn-tracker] r75 - trunk
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/steampress-svn-tracker/2005-November/index.html" >
   <LINK REL="made" HREF="mailto:steampress-svn-tracker%40lists.berlios.de?Subject=Re%3A%20%5Bsteampress-svn-tracker%5D%20r75%20-%20trunk&In-Reply-To=%3C200511082226.jA8MQXu9020701%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000030.html">
   <LINK REL="Next"  HREF="000032.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[steampress-svn-tracker] r75 - trunk</H1>
    <B>steampress-svn-tracker-admin at lists.berlios.de</B> 
    <A HREF="mailto:steampress-svn-tracker%40lists.berlios.de?Subject=Re%3A%20%5Bsteampress-svn-tracker%5D%20r75%20-%20trunk&In-Reply-To=%3C200511082226.jA8MQXu9020701%40sheep.berlios.de%3E"
       TITLE="[steampress-svn-tracker] r75 - trunk">steampress-svn-tracker-admin at lists.berlios.de
       </A><BR>
    <I>Tue Nov  8 23:26:33 CET 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000030.html">[steampress-svn-tracker] r74 - trunk/wp-admin
</A></li>
        <LI>Next message: <A HREF="000032.html">[steampress-svn-tracker] r76 - trunk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31">[ date ]</a>
              <a href="thread.html#31">[ thread ]</a>
              <a href="subject.html#31">[ subject ]</a>
              <a href="author.html#31">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: steamedpenguin
Date: 2005-11-08 23:26:28 +0100 (Tue, 08 Nov 2005)
New Revision: 75

Modified:
   trunk/xmlrpc.php
Log:
Fixed indentation and bracketing. What a fucking mess.

Modified: trunk/xmlrpc.php
===================================================================
--- trunk/xmlrpc.php	2005-11-08 21:25:45 UTC (rev 74)
+++ trunk/xmlrpc.php	2005-11-08 22:26:28 UTC (rev 75)
@@ -13,9 +13,11 @@
 
 $xmlrpc_logging = 0;
 
-function logIO($io,$msg) {
+function logIO($io,$msg)
+{
 	global $xmlrpc_logging;
-	if ($xmlrpc_logging) {
+	if ($xmlrpc_logging)
+	{
 		$fp = fopen(&quot;../xmlrpc.log&quot;,&quot;a+&quot;);
 		$date = gmdate(&quot;Y-m-d H:i:s &quot;);
 		$iot = ($io == &quot;I&quot;) ? &quot; Input: &quot; : &quot; Output: &quot;;
@@ -23,9 +25,10 @@
 		fclose($fp);
 	}
 	return true;
-	}
+}
 
-function starify($string) {
+function starify($string)
+{
 	$i = strlen($string);
 	return str_repeat('*', $i);
 }
@@ -33,1120 +36,1248 @@
 logIO(&quot;I&quot;, $HTTP_RAW_POST_DATA);
 
 
-function mkdir_p($target) {
-	// from php.net/mkdir user contributed notes 
-	if (file_exists($target)) {
-	  if (!is_dir($target)) {
-	    return false;
-	  } else {
-	    return true;
-	  }
+function mkdir_p($target)
+{
+	// from php.net/mkdir user contributed notes
+	if (file_exists($target))
+	{
+		if (!is_dir($target))
+		{
+			return false;
+		}
+		else
+		{
+			return true;
+		}
 	}
 
 	// Attempting to create the directory may clutter up our display.
-	if (@mkdir($target)) {
-	  return true;
+	if (@mkdir($target))
+	{
+		return true;
 	}
 
 	// If the above failed, attempt to create the parent node, then try again.
-	if (mkdir_p(dirname($target))) {
-	  return mkdir_p($target);
+	if (mkdir_p(dirname($target)))
+	{
+		return mkdir_p($target);
 	}
 
 	return false;
 }
 
 
-class wp_xmlrpc_server extends IXR_Server {
+class wp_xmlrpc_server extends IXR_Server
+{
 
-	function wp_xmlrpc_server() {
+	function wp_xmlrpc_server()
+	{
 		$this-&gt;methods = array(
-		  // Blogger API
-		  'blogger.getUsersBlogs' =&gt; 'this:blogger_getUsersBlogs',
-		  'blogger.getUserInfo' =&gt; 'this:blogger_getUserInfo',
-		  'blogger.getPost' =&gt; 'this:blogger_getPost',
-		  'blogger.getRecentPosts' =&gt; 'this:blogger_getRecentPosts',
-		  'blogger.getTemplate' =&gt; 'this:blogger_getTemplate',
-		  'blogger.setTemplate' =&gt; 'this:blogger_setTemplate',
-		  'blogger.newPost' =&gt; 'this:blogger_newPost',
-		  'blogger.editPost' =&gt; 'this:blogger_editPost',
-		  'blogger.deletePost' =&gt; 'this:blogger_deletePost',
+		// Blogger API
+		'blogger.getUsersBlogs' =&gt; 'this:blogger_getUsersBlogs',
+		'blogger.getUserInfo' =&gt; 'this:blogger_getUserInfo',
+		'blogger.getPost' =&gt; 'this:blogger_getPost',
+		'blogger.getRecentPosts' =&gt; 'this:blogger_getRecentPosts',
+		'blogger.getTemplate' =&gt; 'this:blogger_getTemplate',
+		'blogger.setTemplate' =&gt; 'this:blogger_setTemplate',
+		'blogger.newPost' =&gt; 'this:blogger_newPost',
+		'blogger.editPost' =&gt; 'this:blogger_editPost',
+		'blogger.deletePost' =&gt; 'this:blogger_deletePost',
 
-		  // MetaWeblog API (with MT extensions to structs)
-		  'metaWeblog.newPost' =&gt; 'this:mw_newPost',
-		  'metaWeblog.editPost' =&gt; 'this:mw_editPost',
-		  'metaWeblog.getPost' =&gt; 'this:mw_getPost',
-		  'metaWeblog.getRecentPosts' =&gt; 'this:mw_getRecentPosts',
-		  'metaWeblog.getCategories' =&gt; 'this:mw_getCategories',
-		  'metaWeblog.newMediaObject' =&gt; 'this:mw_newMediaObject',
+		// MetaWeblog API (with MT extensions to structs)
+		'metaWeblog.newPost' =&gt; 'this:mw_newPost',
+		'metaWeblog.editPost' =&gt; 'this:mw_editPost',
+		'metaWeblog.getPost' =&gt; 'this:mw_getPost',
+		'metaWeblog.getRecentPosts' =&gt; 'this:mw_getRecentPosts',
+		'metaWeblog.getCategories' =&gt; 'this:mw_getCategories',
+		'metaWeblog.newMediaObject' =&gt; 'this:mw_newMediaObject',
 
-		  // MetaWeblog API aliases for Blogger API
-		  // see <A HREF="http://www.xmlrpc.com/stories/storyReader$2460">http://www.xmlrpc.com/stories/storyReader$2460</A>
-		  'metaWeblog.deletePost' =&gt; 'this:blogger_deletePost',
-		  'metaWeblog.getTemplate' =&gt; 'this:blogger_getTemplate',
-		  'metaWeblog.setTemplate' =&gt; 'this:blogger_setTemplate',
-		  'metaWeblog.getUsersBlogs' =&gt; 'this:blogger_getUsersBlogs',
+		// MetaWeblog API aliases for Blogger API
+		// see <A HREF="http://www.xmlrpc.com/stories/storyReader$2460">http://www.xmlrpc.com/stories/storyReader$2460</A>
+		'metaWeblog.deletePost' =&gt; 'this:blogger_deletePost',
+		'metaWeblog.getTemplate' =&gt; 'this:blogger_getTemplate',
+		'metaWeblog.setTemplate' =&gt; 'this:blogger_setTemplate',
+		'metaWeblog.getUsersBlogs' =&gt; 'this:blogger_getUsersBlogs',
 
-		  // MovableType API
-		  'mt.getCategoryList' =&gt; 'this:mt_getCategoryList',
-		  'mt.getRecentPostTitles' =&gt; 'this:mt_getRecentPostTitles',
-		  'mt.getPostCategories' =&gt; 'this:mt_getPostCategories',
-		  'mt.setPostCategories' =&gt; 'this:mt_setPostCategories',
-		  'mt.supportedMethods' =&gt; 'this:mt_supportedMethods',
-		  'mt.supportedTextFilters' =&gt; 'this:mt_supportedTextFilters',
-		  'mt.getTrackbackPings' =&gt; 'this:mt_getTrackbackPings',
-		  'mt.publishPost' =&gt; 'this:mt_publishPost',
+		// MovableType API
+		'mt.getCategoryList' =&gt; 'this:mt_getCategoryList',
+		'mt.getRecentPostTitles' =&gt; 'this:mt_getRecentPostTitles',
+		'mt.getPostCategories' =&gt; 'this:mt_getPostCategories',
+		'mt.setPostCategories' =&gt; 'this:mt_setPostCategories',
+		'mt.supportedMethods' =&gt; 'this:mt_supportedMethods',
+		'mt.supportedTextFilters' =&gt; 'this:mt_supportedTextFilters',
+		'mt.getTrackbackPings' =&gt; 'this:mt_getTrackbackPings',
+		'mt.publishPost' =&gt; 'this:mt_publishPost',
 
-		  // PingBack
-		  'pingback.ping' =&gt; 'this:pingback_ping',
-		  'pingback.extensions.getPingbacks' =&gt; 'this:pingback_extensions_getPingbacks',
+		// PingBack
+		'pingback.ping' =&gt; 'this:pingback_ping',
+		'pingback.extensions.getPingbacks' =&gt; 'this:pingback_extensions_getPingbacks',
 
-		  'demo.sayHello' =&gt; 'this:sayHello',
-		  'demo.addTwoNumbers' =&gt; 'this:addTwoNumbers'
+		'demo.sayHello' =&gt; 'this:sayHello',
+		'demo.addTwoNumbers' =&gt; 'this:addTwoNumbers'
 		);
 		$this-&gt;methods = apply_filters('xmlrpc_methods', $this-&gt;methods);
 		$this-&gt;IXR_Server($this-&gt;methods);
 	}
 
-	function sayHello($args) {
+	function sayHello($args)
+	{
 		return 'Hello!';
 	}
 
-	function addTwoNumbers($args) {
+	function addTwoNumbers($args)
+	{
 		$number1 = $args[0];
 		$number2 = $args[1];
 		return $number1 + $number2;
 	}
 
-	function login_pass_ok($user_login, $user_pass) {
-	  if (!user_pass_ok($user_login, $user_pass)) {
-	    $this-&gt;error = new IXR_Error(403, 'Bad login/pass combination.');
-	    return false;
-	  }
-	  return true;
+	function login_pass_ok($user_login, $user_pass)
+	{
+		if (!user_pass_ok($user_login, $user_pass))
+		{
+			$this-&gt;error = new IXR_Error(403, 'Bad login/pass combination.');
+			return false;
+		}
+		return true;
 	}
 
-	function escape(&amp;$array) {
+	function escape(&amp;$array)
+	{
 		global $wpdb;
 
-		foreach ($array as $k =&gt; $v) {
-			if (is_array($v)) {
+		foreach ($array as $k =&gt; $v)
+		{
+			if (is_array($v))
+			{
 				$this-&gt;escape($array[$k]);
-			} else if (is_object($v)) {
+			}
+			else if (is_object($v))
+			{
 				//skip
-			} else {
+			}
+			else
+			{
 				$array[$k] = $wpdb-&gt;escape($v);
 			}
 		}
 	}
 
 	/* Blogger API functions
-	 * specs on <A HREF="http://plant.blogger.com/api">http://plant.blogger.com/api</A> and <A HREF="http://groups.yahoo.com/group/bloggerDev/">http://groups.yahoo.com/group/bloggerDev/</A>
-	 */
+	* specs on <A HREF="http://plant.blogger.com/api">http://plant.blogger.com/api</A> and <A HREF="http://groups.yahoo.com/group/bloggerDev/">http://groups.yahoo.com/group/bloggerDev/</A>
+	*/
 
 
 	/* blogger.getUsersBlogs will make more sense once we support multiple blogs */
-	function blogger_getUsersBlogs($args) {
+	function blogger_getUsersBlogs($args)
+	{
 
 		$this-&gt;escape($args);
 
-	  $user_login = $args[1];
-	  $user_pass  = $args[2];
+		$user_login = $args[1];
+		$user_pass  = $args[2];
 
-	  if (!$this-&gt;login_pass_ok($user_login, $user_pass)) {
-	    return $this-&gt;error;
-	  }
+		if (!$this-&gt;login_pass_ok($user_login, $user_pass))
+		{
+			return $this-&gt;error;
+		}
 
-	  $user_data = get_userdatabylogin($user_login);
-	  $is_admin = $user_data-&gt;user_level &gt; 3;
+		$user_data = get_userdatabylogin($user_login);
+		$is_admin = $user_data-&gt;user_level &gt; 3;
 
-	  $struct = array(
-	    'isAdmin'  =&gt; $is_admin,
-	    'url'      =&gt; get_settings('home') . '/',
-	    'blogid'   =&gt; '1',
-	    'blogName' =&gt; get_settings('blogname')
-	  );
+		$struct = array(
+			'isAdmin'  =&gt; $is_admin,
+			'url'      =&gt; get_settings('home') . '/',
+			'blogid'   =&gt; '1',
+			'blogName' =&gt; get_settings('blogname')
+		);
 
-	  return array($struct);
+		return array($struct);
 	}
 
 
 	/* blogger.getUsersInfo gives your client some info about you, so you don't have to */
-	function blogger_getUserInfo($args) {
+	function blogger_getUserInfo($args)
+	{
 
 		$this-&gt;escape($args);
 
-	  $user_login = $args[1];
-	  $user_pass  = $args[2];
+		$user_login = $args[1];
+		$user_pass  = $args[2];
 
-	  if (!$this-&gt;login_pass_ok($user_login, $user_pass)) {
-	    return $this-&gt;error;
-	  }
+		if (!$this-&gt;login_pass_ok($user_login, $user_pass))
+		{
+			return $this-&gt;error;
+		}
 
-	  $user_data = get_userdatabylogin($user_login);
+		$user_data = get_userdatabylogin($user_login);
 
-	  $struct = array(
-	    'nickname'  =&gt; $user_data-&gt;user_nickname,
-	    'userid'    =&gt; $user_data-&gt;ID,
-	    'url'       =&gt; $user_data-&gt;user_url,
-	    'email'     =&gt; $user_data-&gt;user_email,
-	    'lastname'  =&gt; $user_data-&gt;user_lastname,
-	    'firstname' =&gt; $user_data-&gt;user_firstname
-	  );
+		$struct = array(
+			'nickname'  =&gt; $user_data-&gt;user_nickname,
+			'userid'    =&gt; $user_data-&gt;ID,
+			'url'       =&gt; $user_data-&gt;user_url,
+			'email'     =&gt; $user_data-&gt;user_email,
+			'lastname'  =&gt; $user_data-&gt;user_lastname,
+			'firstname' =&gt; $user_data-&gt;user_firstname
+		);
 
-	  return $struct;
+		return $struct;
 	}
 
 
 	/* blogger.getPost ...gets a post */
-	function blogger_getPost($args) {
+	function blogger_getPost($args)
+	{
 
 		$this-&gt;escape($args);
 
-	  $post_ID    = $args[1];
-	  $user_login = $args[2];
-	  $user_pass  = $args[3];
+		$post_ID    = $args[1];
+		$user_login = $args[2];
+		$user_pass  = $args[3];
 
-	  if (!$this-&gt;login_pass_ok($user_login, $user_pass)) {
-	    return $this-&gt;error;
-	  }
+		if (!$this-&gt;login_pass_ok($user_login, $user_pass))
+		{
+			return $this-&gt;error;
+		}
 
-	  $user_data = get_userdatabylogin($user_login);
-	  $post_data = wp_get_single_post($post_ID, ARRAY_A);
+		$user_data = get_userdatabylogin($user_login);
+		$post_data = wp_get_single_post($post_ID, ARRAY_A);
 
-	  $categories = implode(',', wp_get_post_cats(1, $post_ID));
+		$categories = implode(',', wp_get_post_cats(1, $post_ID));
 
-	  $content  = '&lt;title&gt;'.stripslashes($post_data['post_title']).'&lt;/title&gt;';
-	  $content .= '&lt;category&gt;'.$categories.'&lt;/category&gt;';
-	  $content .= stripslashes($post_data['post_content']);
+		$content  = '&lt;title&gt;'.stripslashes($post_data['post_title']).'&lt;/title&gt;';
+		$content .= '&lt;category&gt;'.$categories.'&lt;/category&gt;';
+		$content .= stripslashes($post_data['post_content']);
 
-	  $struct = array(
-	    'userid'    =&gt; $post_data['post_author'],
-	    'dateCreated' =&gt; new IXR_Date(mysql2date('Ymd\TH:i:s', $post_data['post_date'])),
-	    'content'     =&gt; $content,
-	    'postid'  =&gt; $post_data['ID']
-	  );
+		$struct = array(
+			'userid'    =&gt; $post_data['post_author'],
+			'dateCreated' =&gt; new IXR_Date(mysql2date('Ymd\TH:i:s', $post_data['post_date'])),
+			'content'     =&gt; $content,
+			'postid'  =&gt; $post_data['ID']
+		);
 
-	  return $struct;
+		return $struct;
 	}
 
 
 	/* blogger.getRecentPosts ...gets recent posts */
-	function blogger_getRecentPosts($args) {
+	function blogger_getRecentPosts($args)
+	{
 
-	  global $wpdb;
+		global $wpdb;
 
 		$this-&gt;escape($args);
 
-	  $blog_ID    = $args[1]; /* though we don't use it yet */
-	  $user_login = $args[2];
-	  $user_pass  = $args[3];
-	  $num_posts  = $args[4];
+		$blog_ID    = $args[1]; /* though we don't use it yet */
+		$user_login = $args[2];
+		$user_pass  = $args[3];
+		$num_posts  = $args[4];
 
-	  if (!$this-&gt;login_pass_ok($user_login, $user_pass)) {
-	    return $this-&gt;error;
-	  }
+		if (!$this-&gt;login_pass_ok($user_login, $user_pass))
+		{
+			return $this-&gt;error;
+		}
 
-	  $posts_list = wp_get_recent_posts($num_posts);
+		$posts_list = wp_get_recent_posts($num_posts);
 
-	  if (!$posts_list) {
-	    $this-&gt;error = new IXR_Error(500, 'Either there are no posts, or something went wrong.');
-	    return $this-&gt;error;
-	  }
+		if (!$posts_list)
+		{
+			$this-&gt;error = new IXR_Error(500, 'Either there are no posts, or something went wrong.');
+			return $this-&gt;error;
+		}
 
-	  foreach ($posts_list as $entry) {
-	  
-	    $post_date = mysql2date('Ymd\TH:i:s', $entry['post_date']);
-	    $categories = implode(',', wp_get_post_cats(1, $entry['ID']));
+		foreach ($posts_list as $entry)
+		{
+			$post_date = mysql2date('Ymd\TH:i:s', $entry['post_date']);
+			$categories = implode(',', wp_get_post_cats(1, $entry['ID']));
 
-	    $content  = '&lt;title&gt;'.stripslashes($entry['post_title']).'&lt;/title&gt;';
-	    $content .= '&lt;category&gt;'.$categories.'&lt;/category&gt;';
-	    $content .= stripslashes($entry['post_content']);
+			$content  = '&lt;title&gt;'.stripslashes($entry['post_title']).'&lt;/title&gt;';
+			$content .= '&lt;category&gt;'.$categories.'&lt;/category&gt;';
+			$content .= stripslashes($entry['post_content']);
 
-	    $struct[] = array(
-	      'userid' =&gt; $entry['post_author'],
-	      'dateCreated' =&gt; new IXR_Date($post_date),
-	      'content' =&gt; $content,
-	      'postid' =&gt; $entry['ID'],
-	    );
+			$struct[] = array(
+			'userid' =&gt; $entry['post_author'],
+			'dateCreated' =&gt; new IXR_Date($post_date),
+			'content' =&gt; $content,
+			'postid' =&gt; $entry['ID'],
+			);
+		}
 
-	  }
+		$recent_posts = array();
+		for ($j=0; $j&lt;count($struct); $j++)
+		{
+			array_push($recent_posts, $struct[$j]);
+		}
 
-	  $recent_posts = array();
-	  for ($j=0; $j&lt;count($struct); $j++) {
-	    array_push($recent_posts, $struct[$j]);
-	  }
-
-	  return $recent_posts;
+		return $recent_posts;
 	}
 
 
 	/* blogger.getTemplate returns your blog_filename */
-	function blogger_getTemplate($args) {
+	function blogger_getTemplate($args)
+	{
 
 		$this-&gt;escape($args);
 
-	  $blog_ID    = $args[1];
-	  $user_login = $args[2];
-	  $user_pass  = $args[3];
-	  $template   = $args[4]; /* could be 'main' or 'archiveIndex', but we don't use it */
+		$blog_ID    = $args[1];
+		$user_login = $args[2];
+		$user_pass  = $args[3];
+		$template   = $args[4]; /* could be 'main' or 'archiveIndex', but we don't use it */
 
-	  if (!$this-&gt;login_pass_ok($user_login, $user_pass)) {
-	    return $this-&gt;error;
-	  }
+		if (!$this-&gt;login_pass_ok($user_login, $user_pass))
+		{
+			return $this-&gt;error;
+		}
 
-	  $user_data = get_userdatabylogin($user_login);
+		$user_data = get_userdatabylogin($user_login);
 
-	  if ($user_data-&gt;user_level &lt; 3) {
-	    return new IXR_Error(401, 'Sorry, users whose level is less than 3, can not edit the template.');
-	  }
+		if ($user_data-&gt;user_level &lt; 3)
+		{
+			return new IXR_Error(401, 'Sorry, users whose level is less than 3, can not edit the template.');
+		}
 
-	  /* warning: here we make the assumption that the weblog's URI is on the same server */
-	  $filename = get_settings('home') . '/';
-	  $filename = preg_replace('#<A HREF="http://.+?/#">http://.+?/#</A>', $_SERVER['DOCUMENT_ROOT'].'/', $filename);
+		/* warning: here we make the assumption that the weblog's URI is on the same server */
+		$filename = get_settings('home') . '/';
+		$filename = preg_replace('#<A HREF="http://.+?/#">http://.+?/#</A>', $_SERVER['DOCUMENT_ROOT'].'/', $filename);
 
-	  $f = fopen($filename, 'r');
-	  $content = fread($f, filesize($filename));
-	  fclose($f);
+		$f = fopen($filename, 'r');
+		$content = fread($f, filesize($filename));
+		fclose($f);
 
-	  /* so it is actually editable with a windows/mac client */
-	  // FIXME: (or delete me) do we really want to cater to bad clients at the expense of good ones by BEEPing up their line breaks? commented.     $content = str_replace(&quot;\n&quot;, &quot;\r\n&quot;, $content); 
+		/* so it is actually editable with a windows/mac client */
+		// FIXME: (or delete me) do we really want to cater to bad clients at the expense of good ones by BEEPing up their line breaks? commented.     $content = str_replace(&quot;\n&quot;, &quot;\r\n&quot;, $content);
 
-	  return $content;
+		return $content;
 	}
 
 
 	/* blogger.setTemplate updates the content of blog_filename */
-	function blogger_setTemplate($args) {
+	function blogger_setTemplate($args)
+	{
 
 		$this-&gt;escape($args);
 
-	  $blog_ID    = $args[1];
-	  $user_login = $args[2];
-	  $user_pass  = $args[3];
-	  $content    = $args[4];
-	  $template   = $args[5]; /* could be 'main' or 'archiveIndex', but we don't use it */
+		$blog_ID    = $args[1];
+		$user_login = $args[2];
+		$user_pass  = $args[3];
+		$content    = $args[4];
+		$template   = $args[5]; /* could be 'main' or 'archiveIndex', but we don't use it */
 
-	  if (!$this-&gt;login_pass_ok($user_login, $user_pass)) {
-	    return $this-&gt;error;
-	  }
+		if (!$this-&gt;login_pass_ok($user_login, $user_pass))
+		{
+			return $this-&gt;error;
+		}
 
-	  $user_data = get_userdatabylogin($user_login);
+		$user_data = get_userdatabylogin($user_login);
 
-	  if ($user_data-&gt;user_level &lt; 3) {
-	    return new IXR_Error(401, 'Sorry, users whose level is less than 3, can not edit the template.');
-	  }
+		if ($user_data-&gt;user_level &lt; 3)
+		{
+			return new IXR_Error(401, 'Sorry, users whose level is less than 3, can not edit the template.');
+		}
 
-	  /* warning: here we make the assumption that the weblog's URI is on the same server */
-	  $filename = get_settings('home') . '/';
-	  $filename = preg_replace('#<A HREF="http://.+?/#">http://.+?/#</A>', $_SERVER['DOCUMENT_ROOT'].'/', $filename);
+		/* warning: here we make the assumption that the weblog's URI is on the same server */
+		$filename = get_settings('home') . '/';
+		$filename = preg_replace('#<A HREF="http://.+?/#">http://.+?/#</A>', $_SERVER['DOCUMENT_ROOT'].'/', $filename);
 
-	  if ($f = fopen($filename, 'w+')) {
-	    fwrite($f, $content);
-	    fclose($f);
-	  } else {
-	    return new IXR_Error(500, 'Either the file is not writable, or something wrong happened. The file has not been updated.');
-	  }
+		if ($f = fopen($filename, 'w+'))
+		{
+			fwrite($f, $content);
+			fclose($f);
+		}
+		else
+		{
+			return new IXR_Error(500, 'Either the file is not writable, or something wrong happened. The file has not been updated.');
+		}
 
-	  return true;
+		return true;
 	}
 
 
 	/* blogger.newPost ...creates a new post */
-	function blogger_newPost($args) {
+	function blogger_newPost($args)
+	{
 
-	  global $wpdb;
+		global $wpdb;
 
 		$this-&gt;escape($args);
 
-	  $blog_ID    = $args[1]; /* though we don't use it yet */
-	  $user_login = $args[2];
-	  $user_pass  = $args[3];
-	  $content    = $args[4];
-	  $publish    = $args[5];
+		$blog_ID    = $args[1]; /* though we don't use it yet */
+		$user_login = $args[2];
+		$user_pass  = $args[3];
+		$content    = $args[4];
+		$publish    = $args[5];
 
-	  if (!$this-&gt;login_pass_ok($user_login, $user_pass)) {
-	    return $this-&gt;error;
-	  }
+		if (!$this-&gt;login_pass_ok($user_login, $user_pass))
+		{
+			return $this-&gt;error;
+		}
 
-	  $user_data = get_userdatabylogin($user_login);
-	  if (!user_can_create_post($user_data-&gt;ID, $blog_ID)) {
-	    return new IXR_Error(401, 'Sorry, you can not post on this weblog or category.');
-	  }
+		$user_data = get_userdatabylogin($user_login);
+		if (!user_can_create_post($user_data-&gt;ID, $blog_ID))
+		{
+			return new IXR_Error(401, 'Sorry, you can not post on this weblog or category.');
+		}
 
-	  $post_status = ($publish) ? 'publish' : 'draft';
+		$post_status = ($publish) ? 'publish' : 'draft';
 
-	  $post_author = $user_data-&gt;ID;
+		$post_author = $user_data-&gt;ID;
 
-	  $post_title = xmlrpc_getposttitle($content);
-	  $post_category = xmlrpc_getpostcategory($content);
+		$post_title = xmlrpc_getposttitle($content);
+		$post_category = xmlrpc_getpostcategory($content);
 
-	  $content = xmlrpc_removepostdata($content);
-	  $post_content = apply_filters( 'content_save_pre', $content );
+		$content = xmlrpc_removepostdata($content);
+		$post_content = apply_filters( 'content_save_pre', $content );
 
-	  $post_date = current_time('mysql');
-	  $post_date_gmt = current_time('mysql', 1);
+		$post_date = current_time('mysql');
+		$post_date_gmt = current_time('mysql', 1);
 
-	  $post_data = compact('blog_ID', 'post_author', 'post_date', 'post_date_gmt', 'post_content', 'post_title', 'post_category', 'post_status');
+		$post_data = compact('blog_ID', 'post_author', 'post_date', 'post_date_gmt', 'post_content', 'post_title', 'post_category', 'post_status');
 
-	  $post_ID = wp_insert_post($post_data);
+		$post_ID = wp_insert_post($post_data);
 
-	  if (!$post_ID) {
-	    return new IXR_Error(500, 'Sorry, your entry could not be posted. Something wrong happened.');
-	  }
+		if (!$post_ID)
+		{
+			return new IXR_Error(500, 'Sorry, your entry could not be posted. Something wrong happened.');
+		}
 
-	  logIO('O', &quot;Posted ! ID: $post_ID&quot;);
+		logIO('O', &quot;Posted ! ID: $post_ID&quot;);
 
-	  return $post_ID;
+		return $post_ID;
 	}
 
 
 	/* blogger.editPost ...edits a post */
-	function blogger_editPost($args) {
+	function blogger_editPost($args)
+	{
 
-	  global $wpdb;
+		global $wpdb;
 
 		$this-&gt;escape($args);
 
-	  $post_ID     = $args[1];
-	  $user_login  = $args[2];
-	  $user_pass   = $args[3];
-	  $new_content = $args[4];
-	  $publish     = $args[5];
+		$post_ID     = $args[1];
+		$user_login  = $args[2];
+		$user_pass   = $args[3];
+		$new_content = $args[4];
+		$publish     = $args[5];
 
-	  if (!$this-&gt;login_pass_ok($user_login, $user_pass)) {
-	    return $this-&gt;error;
-	  }
+		if (!$this-&gt;login_pass_ok($user_login, $user_pass))
+		{
+			return $this-&gt;error;
+		}
 
-	  $actual_post = wp_get_single_post($post_ID,ARRAY_A);
+		$actual_post = wp_get_single_post($post_ID,ARRAY_A);
 
-	  if (!$actual_post) {
-	  	return new IXR_Error(404, 'Sorry, no such post.');
-	  }
+		if (!$actual_post)
+		{
+			return new IXR_Error(404, 'Sorry, no such post.');
+		}
 
 		$this-&gt;escape($actual_post);
 
-	  $post_author_data = get_userdata($actual_post['post_author']);
-	  $user_data = get_userdatabylogin($user_login);
+		$post_author_data = get_userdata($actual_post['post_author']);
+		$user_data = get_userdatabylogin($user_login);
 
-	  if (!user_can_edit_post($user_data-&gt;ID, $post_ID)) {
-	    return new IXR_Error(401, 'Sorry, you do not have the right to edit this post.');
-	  }
+		if (!user_can_edit_post($user_data-&gt;ID, $post_ID))
+		{
+			return new IXR_Error(401, 'Sorry, you do not have the right to edit this post.');
+		}
 
-	  extract($actual_post);
+		extract($actual_post);
 
-	  $content = $newcontent;
+		$content = $newcontent;
 
-	  $post_title = xmlrpc_getposttitle($content);
-	  $post_category = xmlrpc_getpostcategory($content);
+		$post_title = xmlrpc_getposttitle($content);
+		$post_category = xmlrpc_getpostcategory($content);
 
-	  $content = xmlrpc_removepostdata($content);
-	  $post_content = apply_filters( 'content_save_pre', $content );
+		$content = xmlrpc_removepostdata($content);
+		$post_content = apply_filters( 'content_save_pre', $content );
 
-	  $postdata = compact('ID', 'post_content', 'post_title', 'post_category', 'post_status', 'post_excerpt');
+		$postdata = compact('ID', 'post_content', 'post_title', 'post_category', 'post_status', 'post_excerpt');
 
-	  $result = wp_update_post($postdata);
+		$result = wp_update_post($postdata);
 
-	  if (!$result) {
-	  	return new IXR_Error(500, 'For some strange yet very annoying reason, this post could not be edited.');
-	  }
+		if (!$result)
+		{
+			return new IXR_Error(500, 'For some strange yet very annoying reason, this post could not be edited.');
+		}
 
-	  return true;
+		return true;
 	}
 
 
 	/* blogger.deletePost ...deletes a post */
-	function blogger_deletePost($args) {
+	function blogger_deletePost($args)
+	{
 
-	  global $wpdb;
+		global $wpdb;
 
 		$this-&gt;escape($args);
 
-	  $post_ID     = $args[1];
-	  $user_login  = $args[2];
-	  $user_pass   = $args[3];
-	  $publish     = $args[4];
+		$post_ID     = $args[1];
+		$user_login  = $args[2];
+		$user_pass   = $args[3];
+		$publish     = $args[4];
 
-	  if (!$this-&gt;login_pass_ok($user_login, $user_pass)) {
-	    return $this-&gt;error;
-	  }
+		if (!$this-&gt;login_pass_ok($user_login, $user_pass))
+		{
+			return $this-&gt;error;
+		}
 
-	  $actual_post = wp_get_single_post($post_ID,ARRAY_A);
+		$actual_post = wp_get_single_post($post_ID,ARRAY_A);
 
-	  if (!$actual_post) {
-	  	return new IXR_Error(404, 'Sorry, no such post.');
-	  }
+		if (!$actual_post)
+		{
+			return new IXR_Error(404, 'Sorry, no such post.');
+		}
 
-	  $user_data = get_userdatabylogin($user_login);
+		$user_data = get_userdatabylogin($user_login);
 
-	  if (!user_can_delete_post($user_data-&gt;ID, $post_ID)) {
-	    return new IXR_Error(401, 'Sorry, you do not have the right to delete this post.');
-	  }
+		if (!user_can_delete_post($user_data-&gt;ID, $post_ID))
+		{
+			return new IXR_Error(401, 'Sorry, you do not have the right to delete this post.');
+		}
 
-	  $result = wp_delete_post($post_ID);
+		$result = wp_delete_post($post_ID);
 
-	  if (!$result) {
-	  	return new IXR_Error(500, 'For some strange yet very annoying reason, this post could not be deleted.');
-	  }
+		if (!$result)
+		{
+			return new IXR_Error(500, 'For some strange yet very annoying reason, this post could not be deleted.');
+		}
 
-	  return true;
+		return true;
 	}
 
 
-
 	/* MetaWeblog API functions
-	 * specs on wherever Dave Winer wants them to be
-	 */
+	* specs on wherever Dave Winer wants them to be
+	*/
 
 	/* metaweblog.newPost creates a post */
-	function mw_newPost($args) {
+	function mw_newPost($args)
+	{
 
-	  global $wpdb, $post_default_category;
+		global $wpdb, $post_default_category;
 
 		$this-&gt;escape($args);
 
-	  $blog_ID     = $args[0]; // we will support this in the near future
-	  $user_login  = $args[1];
-	  $user_pass   = $args[2];
-	  $content_struct = $args[3];
-	  $publish     = $args[4];
+		$blog_ID     = $args[0]; // we will support this in the near future
+		$user_login  = $args[1];
+		$user_pass   = $args[2];
+		$content_struct = $args[3];
+		$publish     = $args[4];
 
-	  if (!$this-&gt;login_pass_ok($user_login, $user_pass)) {
-	    return $this-&gt;error;
-	  }
+		if (!$this-&gt;login_pass_ok($user_login, $user_pass))
+		{
+			return $this-&gt;error;
+		}
 
-	  $user_data = get_userdatabylogin($user_login);
-	  if (!user_can_create_post($user_data-&gt;ID, $blog_ID)) {
-	    return new IXR_Error(401, 'Sorry, you can not post on this weblog or category.');
-	  }
+		$user_data = get_userdatabylogin($user_login);
+		if (!user_can_create_post($user_data-&gt;ID, $blog_ID))
+		{
+			return new IXR_Error(401, 'Sorry, you can not post on this weblog or category.');
+		}
 
-	  $post_author = $user_data-&gt;ID;
+		$post_author = $user_data-&gt;ID;
 
-	  $post_title = $content_struct['title'];
-	  $post_content = apply_filters( 'content_save_pre', $content_struct['description'] );
-	  $post_status = $publish ? 'publish' : 'draft';
+		$post_title = $content_struct['title'];
+		$post_content = apply_filters( 'content_save_pre', $content_struct['description'] );
+		$post_status = $publish ? 'publish' : 'draft';
 
-	  $post_excerpt = $content_struct['mt_excerpt'];
-	  $post_more = $content_struct['mt_text_more'];
+		$post_excerpt = $content_struct['mt_excerpt'];
+		$post_more = $content_struct['mt_text_more'];
 
-	  $comment_status = (empty($content_struct['mt_allow_comments'])) ?
-	    get_settings('default_comment_status')
-	    : $content_struct['mt_allow_comments'];
+		$comment_status = (empty($content_struct['mt_allow_comments'])) ?
+			get_settings('default_comment_status')
+			: $content_struct['mt_allow_comments'];
 
-	  $ping_status = (empty($content_struct['mt_allow_pings'])) ?
-	    get_settings('default_ping_status')
-	    : $content_struct['mt_allow_pings'];
+		$ping_status = (empty($content_struct['mt_allow_pings'])) ?
+			get_settings('default_ping_status')
+			: $content_struct['mt_allow_pings'];
 
-	  if ($post_more) {
-	    $post_content = $post_content . &quot;\n&lt;!--more--&gt;\n&quot; . $post_more;
-	  }
+		if ($post_more)
+		{
+			$post_content = $post_content . &quot;\n&lt;!--more--&gt;\n&quot; . $post_more;
+		}
 
-		$to_ping = $content_struct['mt_tb_ping_urls'];
+			$to_ping = $content_struct['mt_tb_ping_urls'];
 
-	  // Do some timestamp voodoo
-	  $dateCreatedd = $content_struct['dateCreated'];
-	  if (!empty($dateCreatedd)) {
-	    $dateCreated = $dateCreatedd-&gt;getIso();
-	    $post_date     = get_date_from_gmt(iso8601_to_datetime($dateCreated));
-	    $post_date_gmt = iso8601_to_datetime($dateCreated, GMT);
-	  } else {
-	    $post_date     = current_time('mysql');
-	    $post_date_gmt = current_time('mysql', 1);
-	  }
+		// Do some timestamp voodoo
+		$dateCreatedd = $content_struct['dateCreated'];
+		if (!empty($dateCreatedd))
+		{
+			$dateCreated = $dateCreatedd-&gt;getIso();
+			$post_date     = get_date_from_gmt(iso8601_to_datetime($dateCreated));
+			$post_date_gmt = iso8601_to_datetime($dateCreated, GMT);
+		}
+		else
+		{
+			$post_date     = current_time('mysql');
+			$post_date_gmt = current_time('mysql', 1);
+		}
 
-	  $catnames = $content_struct['categories'];
-	  logIO('O', 'Post cats: ' . printr($catnames,true));
-	  $post_category = array();
+		$catnames = $content_struct['categories'];
+		logIO('O', 'Post cats: ' . printr($catnames,true));
+		$post_category = array();
 
-	  if (is_array($catnames)) {
-	    foreach ($catnames as $cat) {
-	      $post_category[] = get_cat_ID($cat);
-	    }
-	  }
-		
-	  // We've got all the data -- post it:
-	  $postdata = compact('post_author', 'post_date', 'post_date_gmt', 'post_content', 'post_title', 'post_category', 'post_status', 'post_excerpt', 'comment_status', 'ping_status', 'to_ping');
+		if (is_array($catnames))
+		{
+			foreach ($catnames as $cat)
+			{
+				$post_category[] = get_cat_ID($cat);
+			}
+		}
 
-	  $post_ID = wp_insert_post($postdata);
+		// We've got all the data -- post it:
+		$postdata = compact('post_author', 'post_date', 'post_date_gmt', 'post_content', 'post_title', 'post_category', 'post_status', 'post_excerpt', 'comment_status', 'ping_status', 'to_ping');
 
-	  if (!$post_ID) {
-	    return new IXR_Error(500, 'Sorry, your entry could not be posted. Something wrong happened.');
-	  }
+		$post_ID = wp_insert_post($postdata);
 
-	  logIO('O', &quot;Posted ! ID: $post_ID&quot;);
+		if (!$post_ID)
+		{
+			return new IXR_Error(500, 'Sorry, your entry could not be posted. Something wrong happened.');
+		}
 
-	  // FIXME: do we pingback always? pingback($content, $post_ID);
-	  // trackback_url_list($content_struct['mt_tb_ping_urls'],$post_ID);
+		logIO('O', &quot;Posted ! ID: $post_ID&quot;);
 
-		if ('publish' == $post_status) {
-			if ($post_pingback) pingback($content, $post_ID);
+		// FIXME: do we pingback always? pingback($content, $post_ID);
+		// trackback_url_list($content_struct['mt_tb_ping_urls'],$post_ID);
+
+		if ('publish' == $post_status)
+		{
+			if ($post_pingback)
+			{
+				pingback($content, $post_ID);
+			}
 			do_enclose( $content, $post_ID );
 			do_trackbacks($post_ID);
 			do_action('publish_post', $post_ID);
-		}  
+		}
 
-	  return strval($post_ID);
+		return strval($post_ID);
 	}
 
 
 	/* metaweblog.editPost ...edits a post */
-	function mw_editPost($args) {
+	function mw_editPost($args)
+	{
 
-	  global $wpdb, $post_default_category;
+		global $wpdb, $post_default_category;
 
 		$this-&gt;escape($args);
 
-	  $post_ID     = $args[0];
-	  $user_login  = $args[1];
-	  $user_pass   = $args[2];
-	  $content_struct = $args[3];
-	  $publish     = $args[4];
+		$post_ID     = $args[0];
+		$user_login  = $args[1];
+		$user_pass   = $args[2];
+		$content_struct = $args[3];
+		$publish     = $args[4];
 
-	  if (!$this-&gt;login_pass_ok($user_login, $user_pass)) {
-	    return $this-&gt;error;
-	  }
+		if (!$this-&gt;login_pass_ok($user_login, $user_pass))
+		{
+			return $this-&gt;error;
+		}
 
-	  $user_data = get_userdatabylogin($user_login);
-	  if (!user_can_edit_post($user_data-&gt;ID, $post_ID)) {
-	    return new IXR_Error(401, 'Sorry, you can not edit this post.');
-	  }
+		$user_data = get_userdatabylogin($user_login);
+		if (!user_can_edit_post($user_data-&gt;ID, $post_ID))
+		{
+			return new IXR_Error(401, 'Sorry, you can not edit this post.');
+		}
 
-	  $postdata = wp_get_single_post($post_ID, ARRAY_A);
-	  extract($postdata);
-		$this-&gt;escape($postdata);
+		$postdata = wp_get_single_post($post_ID, ARRAY_A);
+		extract($postdata);
+			$this-&gt;escape($postdata);
 
-	  $post_title = $content_struct['title'];
-	  $post_content = apply_filters( 'content_save_pre', $content_struct['description'] );
-	  $catnames = $content_struct['categories'];
+		$post_title = $content_struct['title'];
+		$post_content = apply_filters( 'content_save_pre', $content_struct['description'] );
+		$catnames = $content_struct['categories'];
 
-	  $post_category = array();
-		
-	  if (is_array($catnames)) {
-	    foreach ($catnames as $cat) {
-	      $post_category[] = get_cat_ID($cat);
-	    }
-	  }
+		$post_category = array();
 
-	  $post_excerpt = $content_struct['mt_excerpt'];
-	  $post_more = $content_struct['mt_text_more'];
-	  $post_status = $publish ? 'publish' : 'draft';
+		if (is_array($catnames))
+		{
+			foreach ($catnames as $cat)
+			{
+				$post_category[] = get_cat_ID($cat);
+			}
+		}
 
-	  if ($post_more) {
-	    $post_content = $post_content . &quot;\n&lt;!--more--&gt;\n&quot; . $post_more;
-	  }
+		$post_excerpt = $content_struct['mt_excerpt'];
+		$post_more = $content_struct['mt_text_more'];
+		$post_status = $publish ? 'publish' : 'draft';
 
+		if ($post_more)
+		{
+			$post_content = $post_content . &quot;\n&lt;!--more--&gt;\n&quot; . $post_more;
+		}
+
 		$to_ping = $content_struct['mt_tb_ping_urls'];
 
-	  $comment_status = (empty($content_struct['mt_allow_comments'])) ?
-	    get_settings('default_comment_status')
-	    : $content_struct['mt_allow_comments'];
+		$comment_status = (empty($content_struct['mt_allow_comments'])) ?
+			get_settings('default_comment_status')
+			: $content_struct['mt_allow_comments'];
 
-	  $ping_status = (empty($content_struct['mt_allow_pings'])) ?
-	    get_settings('default_ping_status')
-	    : $content_struct['mt_allow_pings'];
+		$ping_status = (empty($content_struct['mt_allow_pings'])) ?
+			get_settings('default_ping_status')
+			: $content_struct['mt_allow_pings'];
 
-	  // Do some timestamp voodoo
-	  $dateCreatedd = $content_struct['dateCreated'];
-	  if (!empty($dateCreatedd)) {
-	    $dateCreated = $dateCreatedd-&gt;getIso();
-	    $post_date     = get_date_from_gmt(iso8601_to_datetime($dateCreated));
-	    $post_date_gmt = iso8601_to_datetime($dateCreated, GMT);
-	  } else {
-	    $post_date     = $postdata['post_date'];
-	    $post_date_gmt = $postdata['post_date_gmt'];
-	  }
+		// Do some timestamp voodoo
+		$dateCreatedd = $content_struct['dateCreated'];
+		if (!empty($dateCreatedd))
+		{
+			$dateCreated = $dateCreatedd-&gt;getIso();
+			$post_date     = get_date_from_gmt(iso8601_to_datetime($dateCreated));
+			$post_date_gmt = iso8601_to_datetime($dateCreated, GMT);
+		}
+		else
+		{
+			$post_date     = $postdata['post_date'];
+			$post_date_gmt = $postdata['post_date_gmt'];
+		}
 
-	  // We've got all the data -- post it:
-	  $newpost = compact('ID', 'post_content', 'post_title', 'post_category', 'post_status', 'post_excerpt', 'comment_status', 'ping_status', 'post_date', 'post_date_gmt', 'to_ping');
+		// We've got all the data -- post it:
+		$newpost = compact('ID', 'post_content', 'post_title', 'post_category', 'post_status', 'post_excerpt', 'comment_status', 'ping_status', 'post_date', 'post_date_gmt', 'to_ping');
 
-	  $result = wp_update_post($newpost);
-	  if (!$result) {
-	    return new IXR_Error(500, 'Sorry, your entry could not be edited. Something wrong happened.');
-	  }
+		$result = wp_update_post($newpost);
+		if (!$result)
+		{
+			return new IXR_Error(500, 'Sorry, your entry could not be edited. Something wrong happened.');
+		}
 
-	  logIO('O',&quot;(MW) Edited ! ID: $post_ID&quot;);
+		logIO('O',&quot;(MW) Edited ! ID: $post_ID&quot;);
 
-	  // FIXME: do we pingback always? pingback($content, $post_ID);
-	  // trackback_url_list($content_struct['mt_tb_ping_urls'], $post_ID);
-		if ('publish' == $post_status) {
-			if ($post_pingback) pingback($content, $post_ID);
+		// FIXME: do we pingback always? pingback($content, $post_ID);
+		// trackback_url_list($content_struct['mt_tb_ping_urls'], $post_ID);
+		if ('publish' == $post_status)
+		{
+			if ($post_pingback)
+			{
+				pingback($content, $post_ID);
+			}
 			do_enclose( $content, $post_ID );
 			do_trackbacks($post_ID);
 			do_action('publish_post', $post_ID);
-		}	
+		}
 		do_action('edit_post', $post_ID);
 
-	  return true;
+		return true;
 	}
 
 
 	/* metaweblog.getPost ...returns a post */
-	function mw_getPost($args) {
+	function mw_getPost($args)
+	{
 
-	  global $wpdb;
+		global $wpdb;
 
 		$this-&gt;escape($args);
 
-	  $post_ID     = $args[0];
-	  $user_login  = $args[1];
-	  $user_pass   = $args[2];
+		$post_ID     = $args[0];
+		$user_login  = $args[1];
+		$user_pass   = $args[2];
 
-	  if (!$this-&gt;login_pass_ok($user_login, $user_pass)) {
-	    return $this-&gt;error;
-	  }
+		if (!$this-&gt;login_pass_ok($user_login, $user_pass))
+		{
+			return $this-&gt;error;
+		}
 
-	  $postdata = wp_get_single_post($post_ID, ARRAY_A);
+		$postdata = wp_get_single_post($post_ID, ARRAY_A);
 
-	  if ($postdata['post_date'] != '') {
+		if ($postdata['post_date'] != '')
+		{
 
-	    $post_date = mysql2date('Ymd\TH:i:s', $postdata['post_date']);
+			$post_date = mysql2date('Ymd\TH:i:s', $postdata['post_date']);
 
-	    $categories = array();
-	    $catids = wp_get_post_cats('', $post_ID);
-	    foreach($catids as $catid) {
-	      $categories[] = get_cat_name($catid);
-	    }
+			$categories = array();
+			$catids = wp_get_post_cats('', $post_ID);
+			foreach($catids as $catid)
+			{
+				$categories[] = get_cat_name($catid);
+			}
 
-	    $post = get_extended($postdata['post_content']);
-	    $link = post_permalink($postdata['ID']);
+			$post = get_extended($postdata['post_content']);
+			$link = post_permalink($postdata['ID']);
 
-	    $allow_comments = ('open' == $postdata['comment_status']) ? 1 : 0;
-	    $allow_pings = ('open' == $postdata['ping_status']) ? 1 : 0;
+			$allow_comments = ('open' == $postdata['comment_status']) ? 1 : 0;
+			$allow_pings = ('open' == $postdata['ping_status']) ? 1 : 0;
 
-	    $resp = array(
-	      'dateCreated' =&gt; new IXR_Date($post_date),
-	      'userid' =&gt; $postdata['post_author'],
-	      'postid' =&gt; $postdata['ID'],
-	      'description' =&gt; $post['main'],
-	      'title' =&gt; $postdata['post_title'],
-	      'link' =&gt; $link,
-	      'permaLink' =&gt; $link,
-// commented out because no other tool seems to use this
-//	      'content' =&gt; $entry['post_content'],
-	      'categories' =&gt; $categories,
-	      'mt_excerpt' =&gt; $postdata['post_excerpt'],
-	      'mt_text_more' =&gt; $post['extended'],
-	      'mt_allow_comments' =&gt; $allow_comments,
-	      'mt_allow_pings' =&gt; $allow_pings
-	    );
+			$resp = array(
+			'dateCreated' =&gt; new IXR_Date($post_date),
+			'userid' =&gt; $postdata['post_author'],
+			'postid' =&gt; $postdata['ID'],
+			'description' =&gt; $post['main'],
+			'title' =&gt; $postdata['post_title'],
+			'link' =&gt; $link,
+			'permaLink' =&gt; $link,
+			// commented out because no other tool seems to use this
+			// 'content' =&gt; $entry['post_content'],
+			'categories' =&gt; $categories,
+			'mt_excerpt' =&gt; $postdata['post_excerpt'],
+			'mt_text_more' =&gt; $post['extended'],
+			'mt_allow_comments' =&gt; $allow_comments,
+			'mt_allow_pings' =&gt; $allow_pings
+			);
 
-	    return $resp;
-	  } else {
-	  	return new IXR_Error(404, 'Sorry, no such post.');
-	  }
+			return $resp;
+		}
+		else
+		{
+			return new IXR_Error(404, 'Sorry, no such post.');
+		}
 	}
 
 
 	/* metaweblog.getRecentPosts ...returns recent posts */
-	function mw_getRecentPosts($args) {
+	function mw_getRecentPosts($args)
+	{
 
 		$this-&gt;escape($args);
 
-	  $blog_ID     = $args[0];
-	  $user_login  = $args[1];
-	  $user_pass   = $args[2];
-	  $num_posts   = $args[3];
+		$blog_ID     = $args[0];
+		$user_login  = $args[1];
+		$user_pass   = $args[2];
+		$num_posts   = $args[3];
 
-	  if (!$this-&gt;login_pass_ok($user_login, $user_pass)) {
-	    return $this-&gt;error;
-	  }
+		if (!$this-&gt;login_pass_ok($user_login, $user_pass))
+		{
+			return $this-&gt;error;
+		}
 
-	  $posts_list = wp_get_recent_posts($num_posts);
+		$posts_list = wp_get_recent_posts($num_posts);
 
-	  if (!$posts_list) {
-	    $this-&gt;error = new IXR_Error(500, 'Either there are no posts, or something went wrong.');
-	    return $this-&gt;error;
-	  }
+		if (!$posts_list)
+		{
+			$this-&gt;error = new IXR_Error(500, 'Either there are no posts, or something went wrong.');
+			return $this-&gt;error;
+		}
 
-	  foreach ($posts_list as $entry) {
-	  
-	    $post_date = mysql2date('Ymd\TH:i:s', $entry['post_date']);
-	    $categories = array();
-	    $catids = wp_get_post_cats('', $entry['ID']);
-	    foreach($catids as $catid) {
-	      $categories[] = get_cat_name($catid);
-	    }
+		foreach ($posts_list as $entry)
+		{
+			$post_date = mysql2date('Ymd\TH:i:s', $entry['post_date']);
+			$categories = array();
+			$catids = wp_get_post_cats('', $entry['ID']);
+			foreach($catids as $catid)
+			{
+				$categories[] = get_cat_name($catid);
+			}
 
-	    $post = get_extended($entry['post_content']);
-	    $link = post_permalink($entry['ID']);
+			$post = get_extended($entry['post_content']);
+			$link = post_permalink($entry['ID']);
 
-	    $allow_comments = ('open' == $entry['comment_status']) ? 1 : 0;
-	    $allow_pings = ('open' == $entry['ping_status']) ? 1 : 0;
+			$allow_comments = ('open' == $entry['comment_status']) ? 1 : 0;
+			$allow_pings = ('open' == $entry['ping_status']) ? 1 : 0;
 
-	    $struct[] = array(
-	      'dateCreated' =&gt; new IXR_Date($post_date),
-	      'userid' =&gt; $entry['post_author'],
-	      'postid' =&gt; $entry['ID'],
-	      'description' =&gt; $post['main'],
-	      'title' =&gt; $entry['post_title'],
-	      'link' =&gt; $link,
-	      'permaLink' =&gt; $link,
-// commented out because no other tool seems to use this
-//	      'content' =&gt; $entry['post_content'],
-	      'categories' =&gt; $categories,
-	      'mt_excerpt' =&gt; $entry['post_excerpt'],
-	      'mt_text_more' =&gt; $post['extended'],
-	      'mt_allow_comments' =&gt; $allow_comments,
-	      'mt_allow_pings' =&gt; $allow_pings
-	    );
+			$struct[] = array(
+			'dateCreated' =&gt; new IXR_Date($post_date),
+			'userid' =&gt; $entry['post_author'],
+			'postid' =&gt; $entry['ID'],
+			'description' =&gt; $post['main'],
+			'title' =&gt; $entry['post_title'],
+			'link' =&gt; $link,
+			'permaLink' =&gt; $link,
+			// commented out because no other tool seems to use this
+			// 'content' =&gt; $entry['post_content'],
+			'categories' =&gt; $categories,
+			'mt_excerpt' =&gt; $entry['post_excerpt'],
+			'mt_text_more' =&gt; $post['extended'],
+			'mt_allow_comments' =&gt; $allow_comments,
+			'mt_allow_pings' =&gt; $allow_pings
+			);
+	}
 
-	  }
+	$recent_posts = array();
+	for ($j=0; $j&lt;count($struct); $j++) {
+		array_push($recent_posts, $struct[$j]);
+	}
 
-	  $recent_posts = array();
-	  for ($j=0; $j&lt;count($struct); $j++) {
-	    array_push($recent_posts, $struct[$j]);
-	  }
-	  
-	  return $recent_posts;
+	return $recent_posts;
 	}
 
 
 	/* metaweblog.getCategories ...returns the list of categories on a given weblog */
-	function mw_getCategories($args) {
+	function mw_getCategories($args)
+	{
+		global $wpdb;
 
-	  global $wpdb;
-
 		$this-&gt;escape($args);
 
-	  $blog_ID     = $args[0];
-	  $user_login  = $args[1];
-	  $user_pass   = $args[2];
+		$blog_ID     = $args[0];
+		$user_login  = $args[1];
+		$user_pass   = $args[2];
 
-	  if (!$this-&gt;login_pass_ok($user_login, $user_pass)) {
-	    return $this-&gt;error;
-	  }
+		if (!$this-&gt;login_pass_ok($user_login, $user_pass))
+		{
+			return $this-&gt;error;
+		}
 
-	  $categories_struct = array();
+		$categories_struct = array();
 
-	  // FIXME: can we avoid using direct SQL there?
-	  if ($cats = $wpdb-&gt;get_results(&quot;SELECT cat_ID,cat_name FROM $wpdb-&gt;categories&quot;, ARRAY_A)) {
-	    foreach ($cats as $cat) {
-	      $struct['categoryId'] = $cat['cat_ID'];
-	      $struct['description'] = $cat['cat_name'];
-	      $struct['categoryName'] = $cat['cat_name'];
-	      $struct['htmlUrl'] = wp_specialchars(get_category_link($cat['cat_ID']));
-	      $struct['rssUrl'] = wp_specialchars(get_category_rss_link(false, $cat['cat_ID'], $cat['cat_name']));
+		// FIXME: can we avoid using direct SQL there?
+		if ($cats = $wpdb-&gt;get_results(&quot;SELECT cat_ID,cat_name FROM $wpdb-&gt;categories&quot;, ARRAY_A))
+		{
+			foreach ($cats as $cat)
+			{
+				$struct['categoryId'] = $cat['cat_ID'];
+				$struct['description'] = $cat['cat_name'];
+				$struct['categoryName'] = $cat['cat_name'];
+				$struct['htmlUrl'] = wp_specialchars(get_category_link($cat['cat_ID']));
+				$struct['rssUrl'] = wp_specialchars(get_category_rss_link(false, $cat['cat_ID'], $cat['cat_name']));
 
-	      $categories_struct[] = $struct;
-	    }
-	  }
+				$categories_struct[] = $struct;
+			}
+		}
 
-	  return $categories_struct;
+		return $categories_struct;
 	}
 
 
 	/* metaweblog.newMediaObject uploads a file, following your settings */
-	function mw_newMediaObject($args) {
-	  // adapted from a patch by Johann Richard
-	  // <A HREF="http://mycvs.org/archives/2004/06/30/file-upload-to-wordpress-in-ecto/">http://mycvs.org/archives/2004/06/30/file-upload-to-wordpress-in-ecto/</A>
+	function mw_newMediaObject($args)
+	{
+		// adapted from a patch by Johann Richard
+		// <A HREF="http://mycvs.org/archives/2004/06/30/file-upload-to-wordpress-in-ecto/">http://mycvs.org/archives/2004/06/30/file-upload-to-wordpress-in-ecto/</A>
 
 		global $wpdb;
 
-	  $blog_ID     = $wpdb-&gt;escape($args[0]);
-	  $user_login  = $wpdb-&gt;escape($args[1]);
-		$user_pass   = $wpdb-&gt;escape($args[2]);
-	  $data        = $args[3];
+		$blog_ID     = $wpdb-&gt;escape($args[0]);
+		$user_login  = $wpdb-&gt;escape($args[1]);
+			$user_pass   = $wpdb-&gt;escape($args[2]);
+		$data        = $args[3];
 
-	  $name = $data['name'];
-	  $type = $data['type'];
-	  $bits = $data['bits'];
+		$name = $data['name'];
+		$type = $data['type'];
+		$bits = $data['bits'];
 
-	  $file_realpath = get_settings('fileupload_realpath'); 
-	  $file_url = get_settings('fileupload_url');
+		$file_realpath = get_settings('fileupload_realpath');
+		$file_url = get_settings('fileupload_url');
 
-	  logIO('O', '(MW) Received '.strlen($bits).' bytes');
+		logIO('O', '(MW) Received '.strlen($bits).' bytes');
 
-	  if (!$this-&gt;login_pass_ok($user_login, $user_pass)) {
-	    return $this-&gt;error;
-	  }
+		if (!$this-&gt;login_pass_ok($user_login, $user_pass))
+		{
+			return $this-&gt;error;
+		}
 
-	  $user_data = get_userdatabylogin($user_login);
+		$user_data = get_userdatabylogin($user_login);
 
-	  if(!get_settings('use_fileupload')) {
-	    // Uploads not allowed
-	    logIO('O', '(MW) Uploads not allowed');
-	    $this-&gt;error = new IXR_Error(405, 'No uploads allowed for this site.');
-	    return $this-&gt;error;
-	  } 
+		if(!get_settings('use_fileupload'))
+		{
+			// Uploads not allowed
+			logIO('O', '(MW) Uploads not allowed');
+			$this-&gt;error = new IXR_Error(405, 'No uploads allowed for this site.');
+			return $this-&gt;error;
+		}
 
-	  if(get_settings('fileupload_minlevel') &gt; $user_data-&gt;user_level) {
-	    // User has not enough privileges
-	    logIO('O', '(MW) Not enough privilege: user level too low');
-	    $this-&gt;error = new IXR_Error(401, 'You are not allowed to upload files to this site.');
-	    return $this-&gt;error;
-	  }
+		if(get_settings('fileupload_minlevel') &gt; $user_data-&gt;user_level)
+		{
+			// User has not enough privileges
+			logIO('O', '(MW) Not enough privilege: user level too low');
+			$this-&gt;error = new IXR_Error(401, 'You are not allowed to upload files to this site.');
+			return $this-&gt;error;
+		}
 
-	  if(trim($file_realpath) == '' || trim($file_url) == '' ) {
-	    // WordPress is not correctly configured
-	    logIO('O', '(MW) Bad configuration. Real/URL path not defined');
-	    $this-&gt;error = new IXR_Error(500, 'Please configure WordPress with valid paths for file upload.');
-	    return $this-&gt;error;
-	  }
+		if(trim($file_realpath) == '' || trim($file_url) == '' )
+		{
+			// WordPress is not correctly configured
+			logIO('O', '(MW) Bad configuration. Real/URL path not defined');
+			$this-&gt;error = new IXR_Error(500, 'Please configure WordPress with valid paths for file upload.');
+			return $this-&gt;error;
+		}
 
-	  $prefix = '/';
+		$prefix = '/';
 
-	  if(!empty($name)) {
-	    // Create the path
-	    $localpath = $file_realpath.$prefix.$name;
-	    $url = $file_url.$prefix.$name;
+		if(!empty($name))
+		{
+			// Create the path
+			$localpath = $file_realpath.$prefix.$name;
+			$url = $file_url.$prefix.$name;
 
-	    if (mkdir_p(dirname($localpath))) {
+			if (mkdir_p(dirname($localpath)))
+			{
 
-	      /* encode &amp; write data (binary) */
-	      $ifp = fopen($localpath, 'wb');
-	      $success = fwrite($ifp, $bits);
-	      fclose($ifp);
-	      @chmod($localpath, 0666);
+				/* encode &amp; write data (binary) */
+				$ifp = fopen($localpath, 'wb');
+				$success = fwrite($ifp, $bits);
+				fclose($ifp);
+				@chmod($localpath, 0666);
 
-	      if($success) {
-	        $resp = array('url' =&gt; $url);
-	        return $resp;
-	      } else {
-	        logIO('O', '(MW) Could not write file '.$name.' to '.$localpath);
-	        return new IXR_Error(500, 'Could not write file '.$name);
-	      }
+				if($success)
+				{
+					$resp = array('url' =&gt; $url);
+					return $resp;
+				}
+				else
+				{
+					logIO('O', '(MW) Could not write file '.$name.' to '.$localpath);
+					return new IXR_Error(500, 'Could not write file '.$name);
+				}
 
-	    } else {
-	      return new IXR_Error(500, 'Could not create directories for '.$name);
-	    }
-	  }
+			}
+			else
+			{
+				return new IXR_Error(500, 'Could not create directories for '.$name);
+			}
+		}
 	}
 
-
-
 	/* MovableType API functions
-	 * specs on <A HREF="http://www.movabletype.org/docs/mtmanual_programmatic.html">http://www.movabletype.org/docs/mtmanual_programmatic.html</A>
-	 */
+	* specs on <A HREF="http://www.movabletype.org/docs/mtmanual_programmatic.html">http://www.movabletype.org/docs/mtmanual_programmatic.html</A>
+	*/
 
 	/* mt.getRecentPostTitles ...returns recent posts' titles */
-	function mt_getRecentPostTitles($args) {
+	function mt_getRecentPostTitles($args)
+	{
 
 		$this-&gt;escape($args);
 
-	  $blog_ID     = $args[0];
-	  $user_login  = $args[1];
-	  $user_pass   = $args[2];
-	  $num_posts   = $args[3];
+		$blog_ID     = $args[0];
+		$user_login  = $args[1];
+		$user_pass   = $args[2];
+		$num_posts   = $args[3];
 
-	  if (!$this-&gt;login_pass_ok($user_login, $user_pass)) {
-	    return $this-&gt;error;
-	  }
+		if (!$this-&gt;login_pass_ok($user_login, $user_pass))
+		{
+			return $this-&gt;error;
+		}
 
-	  $posts_list = wp_get_recent_posts($num_posts);
+		$posts_list = wp_get_recent_posts($num_posts);
 
-	  if (!$posts_list) {
-	    $this-&gt;error = new IXR_Error(500, 'Either there are no posts, or something went wrong.');
-	    return $this-&gt;error;
-	  }
+		if (!$posts_list)
+		{
+			$this-&gt;error = new IXR_Error(500, 'Either there are no posts, or something went wrong.');
+			return $this-&gt;error;
+		}
 
-	  foreach ($posts_list as $entry) {
-	  
-	    $post_date = mysql2date('Ymd\TH:i:s', $entry['post_date']);
+		foreach ($posts_list as $entry)
+		{
 
-	    $struct[] = array(
-	      'dateCreated' =&gt; new IXR_Date($post_date),
-	      'userid' =&gt; $entry['post_author'],
-	      'postid' =&gt; $entry['ID'],
-	      'title' =&gt; $entry['post_title'],
-	    );
+			$post_date = mysql2date('Ymd\TH:i:s', $entry['post_date']);
 
-	  }
+			$struct[] = array(
+			'dateCreated' =&gt; new IXR_Date($post_date),
+			'userid' =&gt; $entry['post_author'],
+			'postid' =&gt; $entry['ID'],
+			'title' =&gt; $entry['post_title'],
+			);
+		}
 
-	  $recent_posts = array();
-	  for ($j=0; $j&lt;count($struct); $j++) {
-	    array_push($recent_posts, $struct[$j]);
-	  }
-	  
-	  return $recent_posts;
+		$recent_posts = array();
+		for ($j=0; $j&lt;count($struct); $j++)
+		{
+			array_push($recent_posts, $struct[$j]);
+		}
+
+		return $recent_posts;
 	}
 
 
 	/* mt.getCategoryList ...returns the list of categories on a given weblog */
-	function mt_getCategoryList($args) {
+	function mt_getCategoryList($args)
+	{
 
-	  global $wpdb;
+		global $wpdb;
 
 		$this-&gt;escape($args);
 
-	  $blog_ID     = $args[0];
-	  $user_login  = $args[1];
-	  $user_pass   = $args[2];
+		$blog_ID     = $args[0];
+		$user_login  = $args[1];
+		$user_pass   = $args[2];
 
-	  if (!$this-&gt;login_pass_ok($user_login, $user_pass)) {
-	    return $this-&gt;error;
-	  }
+		if (!$this-&gt;login_pass_ok($user_login, $user_pass))
+		{
+			return $this-&gt;error;
+		}
 
-	  $categories_struct = array();
+		$categories_struct = array();
 
-	  // FIXME: can we avoid using direct SQL there?
-	  if ($cats = $wpdb-&gt;get_results(&quot;SELECT cat_ID, cat_name FROM $wpdb-&gt;categories&quot;, ARRAY_A)) {
-	    foreach ($cats as $cat) {
-	      $struct['categoryId'] = $cat['cat_ID'];
-	      $struct['categoryName'] = $cat['cat_name'];
+		// FIXME: can we avoid using direct SQL there?
+		if ($cats = $wpdb-&gt;get_results(&quot;SELECT cat_ID, cat_name FROM $wpdb-&gt;categories&quot;, ARRAY_A))
+		{
+			foreach ($cats as $cat)
+			{
+				$struct['categoryId'] = $cat['cat_ID'];
+				$struct['categoryName'] = $cat['cat_name'];
 
-	      $categories_struct[] = $struct;
-	    }
-	  }
+				$categories_struct[] = $struct;
+			}
+		}
 
-	  return $categories_struct;
+		return $categories_struct;
 	}
 
 
 	/* mt.getPostCategories ...returns a post's categories */
-	function mt_getPostCategories($args) {
+	function mt_getPostCategories($args)
+	{
 
 		$this-&gt;escape($args);
 
-	  $post_ID     = $args[0];
-	  $user_login  = $args[1];
-	  $user_pass   = $args[2];
+		$post_ID     = $args[0];
+		$user_login  = $args[1];
+		$user_pass   = $args[2];
 
-	  if (!$this-&gt;login_pass_ok($user_login, $user_pass)) {
-	    return $this-&gt;error;
-	  }
+		if (!$this-&gt;login_pass_ok($user_login, $user_pass))
+		{
+			return $this-&gt;error;
+		}
 
-	  $categories = array();
-	  $catids = wp_get_post_cats('', intval($post_ID));
-	  // first listed category will be the primary category
-	  $isPrimary = true;
-	  foreach($catids as $catid) {
-	    $categories[] = array(
-	      'categoryName' =&gt; get_cat_name($catid),
-	      'categoryId' =&gt; $catid,
-	      'isPrimary' =&gt; $isPrimary
-	    );
-	    $isPrimary = false;
-	  }
- 
-	  return $categories;
+		$categories = array();
+		$catids = wp_get_post_cats('', intval($post_ID));
+		// first listed category will be the primary category
+		$isPrimary = true;
+		foreach($catids as $catid)
+		{
+			$categories[] = array(
+			'categoryName' =&gt; get_cat_name($catid),
+			'categoryId' =&gt; $catid,
+			'isPrimary' =&gt; $isPrimary
+			);
+			$isPrimary = false;
+		}
+
+		return $categories;
 	}
 
 
 	/* mt.setPostCategories ...sets a post's categories */
-	function mt_setPostCategories($args) {
+	function mt_setPostCategories($args)
+	{
 
 		$this-&gt;escape($args);
 
-	  $post_ID     = $args[0];
-	  $user_login  = $args[1];
-	  $user_pass   = $args[2];
-	  $categories  = $args[3];
+		$post_ID     = $args[0];
+		$user_login  = $args[1];
+		$user_pass   = $args[2];
+		$categories  = $args[3];
 
-	  if (!$this-&gt;login_pass_ok($user_login, $user_pass)) {
-	    return $this-&gt;error;
-	  }
+		if (!$this-&gt;login_pass_ok($user_login, $user_pass))
+		{
+			return $this-&gt;error;
+		}
 
-	  $user_data = get_userdatabylogin($user_login);
-	  if (!user_can_edit_post($user_data-&gt;ID, $post_ID)) {
-	    return new IXR_Error(401, 'Sorry, you can not edit this post.');
-	  }
+		$user_data = get_userdatabylogin($user_login);
+		if (!user_can_edit_post($user_data-&gt;ID, $post_ID))
+		{
+			return new IXR_Error(401, 'Sorry, you can not edit this post.');
+		}
 
-	  foreach($categories as $cat) {
-	    $catids[] = $cat['categoryId'];
-	  }
-	
-	  wp_set_post_cats('', $post_ID, $catids);
+		foreach($categories as $cat)
+		{
+			$catids[] = $cat['categoryId'];
+		}
 
-	  return true;
+		wp_set_post_cats('', $post_ID, $catids);
+
+		return true;
 	}
 
 
 	/* mt.supportedMethods ...returns an array of methods supported by this server */
-	function mt_supportedMethods($args) {
+	function mt_supportedMethods($args)
+	{
 
-	  $supported_methods = array();
-	  foreach($this-&gt;methods as $key=&gt;$value) {
-	    $supported_methods[] = $key;
-	  }
+	$supported_methods = array();
+	foreach($this-&gt;methods as $key=&gt;$value)
+	{
+		$supported_methods[] = $key;
+	}
 
-	  return $supported_methods;
+	return $supported_methods;
 	}
 
 
 	/* mt.supportedTextFilters ...returns an empty array because we don't
-	   support per-post text filters yet */
-	function mt_supportedTextFilters($args) {
-	  return array();
+	support per-post text filters yet */
+	function mt_supportedTextFilters($args)
+	{
+		return array();
 	}
 
 
 	/* mt.getTrackbackPings ...returns trackbacks sent to a given post */
-	function mt_getTrackbackPings($args) {
+	function mt_getTrackbackPings($args)
+	{
 
-	  global $wpdb;
+		global $wpdb;
 
-	  $post_ID = intval($args);
+		$post_ID = intval($args);
 
-	  $actual_post = wp_get_single_post($post_ID, ARRAY_A);
+		$actual_post = wp_get_single_post($post_ID, ARRAY_A);
 
-	  if (!$actual_post) {
-	  	return new IXR_Error(404, 'Sorry, no such post.');
-	  }
+		if (!$ACTUAL_POST)
+		{
+			RETURN NEW IXR_ERROR(404, 'SORRY, NO SUCH POST.');
+		}
 
-	  $comments = $wpdb-&gt;get_results(&quot;SELECT comment_author_url, comment_content, comment_author_IP, comment_type FROM $wpdb-&gt;comments WHERE comment_post_ID = $post_ID&quot;);
+		$comments = $wpdb-&gt;get_results(&quot;SELECT comment_author_url, comment_content, comment_author_IP, comment_type FROM $wpdb-&gt;comments WHERE comment_post_ID = $post_ID&quot;);
 
-	  if (!$comments) {
-	  	return array();
-	  }
+		if (!$comments)
+		{
+			return array();
+		}
 
-	  $trackback_pings = array();
-	  foreach($comments as $comment) {
-	    if ( 'trackback' == $comment-&gt;comment_type ) {
-	      $content = $comment-&gt;comment_content;
-	      $title = substr($content, 8, (strpos($content, '&lt;/strong&gt;') - 8));
-	      $trackback_pings[] = array(
-	        'pingTitle' =&gt; $title,
-	        'pingURL'   =&gt; $comment-&gt;comment_author_url,
-	        'pingIP'    =&gt; $comment-&gt;comment_author_IP
-	      );
+		$trackback_pings = array();
+		foreach($comments as $comment)
+		{
+			if ( 'trackback' == $comment-&gt;comment_type )
+			{
+				$content = $comment-&gt;comment_content;
+				$title = substr($content, 8, (strpos($content, '&lt;/strong&gt;') - 8));
+				$trackback_pings[] = array(
+					'pingTitle' =&gt; $title,
+					'pingURL'   =&gt; $comment-&gt;comment_author_url,
+					'pingIP'    =&gt; $comment-&gt;comment_author_IP
+				);
+			}
 		}
-	  }
 
-	  return $trackback_pings;
+		return $trackback_pings;
 	}
 
 
 	/* mt.publishPost ...sets a post's publish status to 'publish' */
-	function mt_publishPost($args) {
+	function mt_publishPost($args)
+	{
 
 		$this-&gt;escape($args);
 
-	  $post_ID     = $args[0];
-	  $user_login  = $args[1];
-	  $user_pass   = $args[2];
+		$post_ID     = $args[0];
+		$user_login  = $args[1];
+		$user_pass   = $args[2];
 
-	  if (!$this-&gt;login_pass_ok($user_login, $user_pass)) {
-	    return $this-&gt;error;
-	  }
+		if (!$this-&gt;login_pass_ok($user_login, $user_pass))
+		{
+			return $this-&gt;error;
+		}
 
-	  $user_data = get_userdatabylogin($user_login);
-	  if (!user_can_edit_post($user_data-&gt;ID, $post_ID)) {
-	    return new IXR_Error(401, 'Sorry, you can not edit this post.');
-	  }
+		$user_data = get_userdatabylogin($user_login);
+		if (!user_can_edit_post($user_data-&gt;ID, $post_ID))
+		{
+			return new IXR_Error(401, 'Sorry, you can not edit this post.');
+		}
 
-	  $postdata = wp_get_single_post($post_ID,ARRAY_A);
+		$postdata = wp_get_single_post($post_ID,ARRAY_A);
 
-	  $postdata['post_status'] = 'publish';
+		$postdata['post_status'] = 'publish';
 
-	  // retain old cats
-	  $cats = wp_get_post_cats('',$post_ID);
-	  $postdata['post_category'] = $cats;
+		// retain old cats
+		$cats = wp_get_post_cats('',$post_ID);
+		$postdata['post_category'] = $cats;
 		$this-&gt;escape($postdata);
 
-	  $result = wp_update_post($postdata);
+		$result = wp_update_post($postdata);
 
-	  return $result;
+		return $result;
 	}
 
 
 
 	/* PingBack functions
-	 * specs on www.hixie.ch/specs/pingback/pingback
-	 */
+	* specs on www.hixie.ch/specs/pingback/pingback
+	*/
 
 	/* pingback.ping gets a pingback and registers it */
-	function pingback_ping($args) {
-		global $wpdb, $wp_version; 
+	function pingback_ping($args)
+	{
+		global $wpdb, $wp_version;
 
 		$this-&gt;escape($args);
 
@@ -1163,47 +1294,64 @@
 		// Check if the page linked to is in our site
 		$pos1 = strpos($pagelinkedto, str_replace('<A HREF="http://">http://</A>', '', str_replace('www.', '', get_settings('home'))));
 		if( !$pos1 )
-	  		return new IXR_Error(0, 'Is there no link to us?');
+		{
+			return new IXR_Error(0, 'Is there no link to us?');
+		}
 
 		// let's find which post is linked to
 		// FIXME: does url_to_postid() cover all these cases already?
 		//        if so, then let's use it and drop the old code.
 		$urltest = parse_url($pagelinkedto);
-		if ($post_ID = url_to_postid($pagelinkedto)) {
+		if ($post_ID = url_to_postid($pagelinkedto))
+		{
 			$way = 'url_to_postid()';
-		} elseif (preg_match('#p/[0-9]{1,}#', $urltest['path'], $match)) {
+		}
+		elseif (preg_match('#p/[0-9]{1,}#', $urltest['path'], $match))
+		{
 			// the path defines the post_ID (archives/p/XXXX)
 			$blah = explode('/', $match[0]);
 			$post_ID = $blah[1];
 			$way = 'from the path';
-		} elseif (preg_match('#p=[0-9]{1,}#', $urltest['query'], $match)) {
+		}
+		elseif (preg_match('#p=[0-9]{1,}#', $urltest['query'], $match))
+		{
 			// the querystring defines the post_ID (?p=XXXX)
 			$blah = explode('=', $match[0]);
 			$post_ID = $blah[1];
 			$way = 'from the querystring';
-		} elseif (isset($urltest['fragment'])) {
+		}
+		elseif (isset($urltest['fragment']))
+		{
 			// an #anchor is there, it's either...
-			if (intval($urltest['fragment'])) {
+			if (intval($urltest['fragment']))
+			{
 				// ...an integer #XXXX (simpliest case)
 				$post_ID = $urltest['fragment'];
 				$way = 'from the fragment (numeric)';
-			} elseif (preg_match('/post-[0-9]+/',$urltest['fragment'])) {
+			}
+			elseif (preg_match('/post-[0-9]+/',$urltest['fragment']))
+			{
 				// ...a post id in the form 'post-###'
 				$post_ID = preg_replace('/[^0-9]+/', '', $urltest['fragment']);
 				$way = 'from the fragment (post-###)';
-			} elseif (is_string($urltest['fragment'])) {
+			}
+			elseif (is_string($urltest['fragment']))
+			{
 				// ...or a string #title, a little more complicated
 				$title = preg_replace('/[^a-z0-9]/i', '.', $urltest['fragment']);
 				$sql = &quot;SELECT ID FROM $wpdb-&gt;posts WHERE post_title RLIKE '$title'&quot;;
-				if (! ($post_ID = $wpdb-&gt;get_var($sql)) ) {
+				if (! ($post_ID = $wpdb-&gt;get_var($sql)) )
+				{
 					// returning unknown error '0' is better than die()ing
-			  		return new IXR_Error(0, '');
+					return new IXR_Error(0, '');
 				}
 				$way = 'from the fragment (title)';
 			}
-		} else {
+		}
+		else
+		{
 			// TODO: Attempt to extract a post ID from the given URL
-	  		return new IXR_Error(33, 'The specified target URI cannot be used as a target. It either doesn\'t exist, or it is not a pingback-enabled resource.');
+			return new IXR_Error(33, 'The specified target URI cannot be used as a target. It either doesn\'t exist, or it is not a pingback-enabled resource.');
 		}
 		$post_ID = (int) $post_ID;
 
@@ -1213,17 +1361,23 @@
 		$post = get_post($post_ID);
 
 		if ( !$post ) // Post_ID not found
-	  		return new IXR_Error(33, 'The specified target URI cannot be used as a target. It either doesn\'t exist, or it is not a pingback-enabled resource.');
+		{
+			return new IXR_Error(33, 'The specified target URI cannot be used as a target. It either doesn\'t exist, or it is not a pingback-enabled resource.');
+		}
 
 		// Check if pings are on
 		if ( 'closed' == $post-&gt;ping_status )
-	  		return new IXR_Error(33, 'The specified target URI cannot be used as a target. It either doesn\'t exist, or it is not a pingback-enabled resource.');
+		{
+			return new IXR_Error(33, 'The specified target URI cannot be used as a target. It either doesn\'t exist, or it is not a pingback-enabled resource.');
+		}
 
 		// Let's check that the remote site didn't already pingback this entry
 		$result = $wpdb-&gt;get_results(&quot;SELECT * FROM $wpdb-&gt;comments WHERE comment_post_ID = '$post_ID' AND comment_author_url = '$pagelinkedfrom'&quot;);
 
 		if ( $wpdb-&gt;num_rows ) // We already have a Pingback from this URL
-	  		return new IXR_Error(48, 'The pingback has already been registered.');
+		{
+			return new IXR_Error(48, 'The pingback has already been registered.');
+		}
 
 		// very stupid, but gives time to the 'from' server to publish !
 		sleep(1);
@@ -1231,7 +1385,9 @@
 		// Let's check the remote site
 		$linea = wp_remote_fopen( $pagelinkedfrom );
 		if ( !$linea )
-	  		return new IXR_Error(16, 'The source URI does not exist.');
+		{
+			return new IXR_Error(16, 'The source URI does not exist.');
+		}
 
 		// Work around bug in strip_tags():
 		$linea = str_replace('&lt;!DOC', '&lt;DOC', $linea);
@@ -1241,21 +1397,27 @@
 		preg_match('|&lt;title&gt;([^&lt;]*?)&lt;/title&gt;|is', $linea, $matchtitle);
 		$title = $matchtitle[1];
 		if ( empty( $title ) )
+		{
 			return new IXR_Error(32, 'We cannot find a title on that page.');
+		}
 
 		$linea = strip_tags( $linea, '&lt;a&gt;' ); // just keep the tag we need
 
 		$p = explode( &quot;\n\n&quot;, $linea );
-		
+
 		$sem_regexp_pb = &quot;/(\\/|\\\|\*|\?|\+|\.|\^|\\$|\(|\)|\[|\]|\||\{|\})/&quot;;
 		$sem_regexp_fix = &quot;\\\\$1&quot;;
 		$link = preg_replace( $sem_regexp_pb, $sem_regexp_fix, $pagelinkedfrom );
-		
+
 		$finished = false;
-		foreach ( $p as $para ) {
+		foreach ( $p as $para )
+		{
 			if ( $finished )
+			{
 				continue;
-			if ( strstr( $para, $pagelinkedto ) ) {
+			}
+			if ( strstr( $para, $pagelinkedto ) )
+			{
 				$context = preg_replace( &quot;/.*&lt;a[^&gt;]+&quot;.$link.&quot;[^&gt;]*&gt;([^&gt;]+)&lt;\/a&gt;.*/&quot;, &quot;$1&quot;, $para );
 				$excerpt = strip_tags( $para );
 				$excerpt = trim( $excerpt );
@@ -1266,7 +1428,9 @@
 		}
 
 		if ( empty($context) )  // URL pattern not found
+		{
 			return new IXR_Error(17, 'The source URI does not contain a link to the target URI, and so cannot be used as a source.');
+		}
 
 		$pagelinkedfrom = preg_replace('#&amp;([^amp\;])#is', '&amp;$1', $pagelinkedfrom);
 
@@ -1285,15 +1449,16 @@
 
 		wp_new_comment($commentdata);
 		do_action('pingback_post', $wpdb-&gt;insert_id);
-		
+
 		return &quot;Pingback from $pagelinkedfrom to $pagelinkedto registered. Keep the web talking! :-)&quot;;
 	}
 
 
 	/* pingback.extensions.getPingbacks returns an array of URLs
-	   that pingbacked the given URL
-	   specs on <A HREF="http://www.aquarionics.com/misc/archives/blogite/0198.html">http://www.aquarionics.com/misc/archives/blogite/0198.html</A> */
-	function pingback_extensions_getPingbacks($args) {
+	that pingbacked the given URL
+	specs on <A HREF="http://www.aquarionics.com/misc/archives/blogite/0198.html">http://www.aquarionics.com/misc/archives/blogite/0198.html</A> */
+	function pingback_extensions_getPingbacks($args)
+	{
 
 		global $wpdb;
 
@@ -1302,28 +1467,34 @@
 		$url = $args;
 
 		$post_ID = url_to_postid($url);
-		if (!$post_ID) {
+		if (!$post_ID)
+		{
 			// We aren't sure that the resource is available and/or pingback enabled
-	  		return new IXR_Error(33, 'The specified target URI cannot be used as a target. It either doesn\'t exist, or it is not a pingback-enabled resource.');
+			return new IXR_Error(33, 'The specified target URI cannot be used as a target. It either doesn\'t exist, or it is not a pingback-enabled resource.');
 		}
 
 		$actual_post = wp_get_single_post($post_ID, ARRAY_A);
 
-		if (!$actual_post) {
+		if (!$actual_post)
+		{
 			// No such post = resource not found
-	  		return new IXR_Error(32, 'The specified target URI does not exist.');
+			return new IXR_Error(32, 'The specified target URI does not exist.');
 		}
 
 		$comments = $wpdb-&gt;get_results(&quot;SELECT comment_author_url, comment_content, comment_author_IP, comment_type FROM $wpdb-&gt;comments WHERE comment_post_ID = $post_ID&quot;);
 
-		if (!$comments) {
+		if (!$comments)
+		{
 			return array();
 		}
 
 		$pingbacks = array();
-		foreach($comments as $comment) {
+		foreach($comments as $comment)
+		{
 			if ( 'pingback' == $comment-&gt;comment_type )
+			{
 				$pingbacks[] = $comment-&gt;comment_author_url;
+			}
 		}
 
 		return $pingbacks;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000030.html">[steampress-svn-tracker] r74 - trunk/wp-admin
</A></li>
	<LI>Next message: <A HREF="000032.html">[steampress-svn-tracker] r76 - trunk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#31">[ date ]</a>
              <a href="thread.html#31">[ thread ]</a>
              <a href="subject.html#31">[ subject ]</a>
              <a href="author.html#31">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/steampress-svn-tracker">More information about the steampress-svn-tracker
mailing list</a><br>
</body></html>
